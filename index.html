<script>
  const uploadForm = document.getElementById('uploadForm');
  const metadataSection = document.getElementById('metadata');
  const downloadSection = document.getElementById('downloadSection');
  const author = document.getElementById('author');
  const title = document.getElementById('title');
  const subject = document.getElementById('subject');
  const downloadLink = document.getElementById('downloadLink');
  const loadingIndicator = document.getElementById('loading');

  // Get the base URL dynamically
  const baseUrl = window.location.origin;

  uploadForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    loadingIndicator.style.display = 'block';
    const formData = new FormData(uploadForm);

    try {
      // Step 1: Upload the file to the File Upload Service
      const uploadResponse = await fetch(`${baseUrl}/upload`, {
        method: 'POST',
        body: formData
      });
      const uploadData = await uploadResponse.json();

      // Step 2: Convert the file to PDF
      const conversionResponse = await fetch(`${baseUrl}/convert-to-pdf`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ filePath: uploadData.filePath })
      });

      if (!conversionResponse.ok) {
        throw new Error('Failed to convert file to PDF');
      }

      // Step 3: Download the file
      const blob = await conversionResponse.blob();
      const downloadUrl = URL.createObjectURL(blob);
      const tempLink = document.createElement('a');
      tempLink.href = downloadUrl;
      tempLink.download = 'converted-file.pdf'; // Default file name
      document.body.appendChild(tempLink);
      tempLink.click();
      document.body.removeChild(tempLink);
      URL.revokeObjectURL(downloadUrl);
    } catch (error) {
      alert(`Error processing file: ${error}`);
    } finally {
      // Hide the loading indicator
      loadingIndicator.style.display = 'none';
    }
  });
</script>
